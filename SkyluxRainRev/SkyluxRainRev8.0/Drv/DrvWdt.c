/*
 * DrvWdt.c
 *
 * Created: 01/05/2019 09:54:22
 *  Author: Vermeersch Stijn
 */ 
/**********************************************************************************************************************/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; V E R I F Y    C O N F I G U R A T I O N
;---------------------------------------------------------------------------------------------------------------------*/
/**********************************************************************************************************************/



/***********************************************************************************************************************
; I N C L U D E S
;---------------------------------------------------------------------------------------------------------------------*/
#include <peripheral_clk_config.h>
#include <utils.h>
#include <hal_init.h>
#include <hal_wdt.h>
#include <hpl_gpio.h>
#include <hpl_gclk_base.h>
#include <hpl_pm_base.h>
#include "utils.h"

#include "DrvWdt.h"
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   D E F I N I T I O N S   A N D   M A C R O S
;---------------------------------------------------------------------------------------------------------------------*/
/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   T Y P E D E F S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   F U N C T I O N   P R O T O T Y P E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/
static struct wdt_descriptor WDT_0;
static uint16_t localtimeout = 0;
/**********************************************************************************************************************/

/***********************************************************************************************************************
; E X P O R T E D   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/
/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; E X P O R T E D   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
void DrvWdtInit(void)
{
	_pm_enable_bus_clock(PM_BUS_APBA, WDT);
	_gclk_enable_channel(WDT_GCLK_ID, CONF_GCLK_WDT_SRC);
	
	wdt_init(&WDT_0, WDT);
	
	
		//uint32_t clk_rate;
	//uint16_t timeout_period;
//
	//clk_rate       = 1000;
	//timeout_period = 4096;
	//wdt_set_timeout_period(&WDT_0, clk_rate, timeout_period);
	//wdt_enable(&WDT_0);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvWdtDeInit(void)
{
	wdt_deinit(&WDT_0);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvWdtRestart(void)
{
	wdt_init(&WDT_0, WDT);
	wdt_enable(&WDT_0);
	wdt_set_timeout_period(&WDT_0, 32768, localtimeout);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvWdtEnable(void)
{
	wdt_enable(&WDT_0);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvWdtDisable(void)
{
	wdt_disable(&WDT_0);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvWdtSetTimeout(uint16_t timeout)
{
	localtimeout = timeout;
	wdt_set_timeout_period(&WDT_0, 32768, timeout);
}
/*--------------------------------------------------------------------------------------------------------------------*/
void DrvWdtFeed(void)
{
	wdt_feed(&WDT_0);
}
/**********************************************************************************************************************/